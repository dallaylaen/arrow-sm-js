<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>State machine example - ArrowSM</title>
    <script lang="javascript" src="js/arrow-sm.js"></script>
    <script lang="javascript">
        window.onerror = function(msg) {
            document.getElementById("error").innerHTML += '<div>'+msg+'</div>';
        };
    </script>
    <style>
        #state {
            color: blue;
        }
        #display {
            color: red;
        }
    </style>
</head>
<body>
    <div id="error" style="color: red"></div>
    <h1>State machine example - ArrowSM</h1>

    <!-- initial node to attach to -->
    <div id="root">
        <button id="select">select</button>
        <button id="pay">pay</button>
        <button id="leave">leave</button>
        <hr>
        <div>Current state: <span id="state"></span></div>
        <div id="display"></div>
    </div>

    <!-- the script is here -->
    <script lang="javascript" id="main">
        "use strict";

        const sm = new ArrowSM({
                empty:    arg => {
                    if (arg === 'select') return 'cart';
                    if (arg === 'pay')    return [undefined, 'Nothing to pay for!'];
                },
                cart:     arg => {
                    if (arg === 'pay')    return [ 'checkout', 'Confirm payment' ];
                    if (arg === 'leave')  return [ 'empty', 'Order cancelled'];
                },
                checkout: arg => {
                    if (arg === 'leave')  return [ 'empty', 'Payment declined' ];
                    if (arg === 'pay')    return [ 'empty', 'Payment approved' ];
                    if (arg === 'select') return [ undefined, 'Cannot select on checkout. Confirm payment first.' ];
                },
            })
            .onSwitch( (arg, from, to) => { document.getElementById('state').innerHTML = to } )
            .start('empty');

        for (let i of ['select', 'pay', 'leave']) {
            const trigger = i;
            document.getElementById(i).onclick = function() {
                document.getElementById('display').innerHTML = sm(trigger) || '';
            };
        };
    </script>

    <!-- describe how to use the page, if needed -->
    <div id="usage">
    </div>
</body>
</html>
